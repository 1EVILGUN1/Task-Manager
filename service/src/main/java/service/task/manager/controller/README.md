# README.md для папки `controller`

## Описание

Папка `controller` содержит REST-контроллеры приложения `service.task.manager`, разработанного на Spring Boot. Контроллеры обрабатывают HTTP-запросы для управления задачами, эпиками, подзадачами и историей доступа. Все эндпоинты задокументированы с использованием аннотаций OpenAPI (Swagger), что упрощает интеграцию и тестирование API. Логирование реализовано через SLF4J, а валидация данных — через Jakarta Validation.

## Структура папки

Папка включает следующие контроллеры:

### 1. `EpicController.java`
**Описание**: Управляет эпиками — крупными задачами, содержащими подзадачи.  
**Эндпоинты**:
- `POST /epic` — Создание нового эпика.
- `PUT /epic` — Обновление существующего эпика.
- `GET /epic/{id}` — Получение эпика по ID (включая подзадачи).
- `GET /epic` — Получение списка всех эпиков.
- `DELETE /epic/{id}` — Удаление эпика по ID.
- `GET /epic/prioritized` — Получение эпиков, отсортированных по приоритету (`IN_PROGRESS`, `NEW`, `DONE`) и времени завершения.

### 2. `HistoryController.java`
**Описание**: Предоставляет доступ к истории вызовов метода `findById` для задач, эпиков и подзадач.  
**Эндпоинты**:
- `GET /history` — Получение последних 10 записей истории доступа.

### 3. `SubtaskController.java`
**Описание**: Управляет подзадачами, связанными с эпиками.  
**Эндпоинты**:
- `POST /subtask` — Создание новой подзадачи.
- `PUT /subtask` — Обновление существующей подзадачи.
- `GET /subtask/{id}` — Получение подзадачи по ID.
- `GET /subtask` — Получение списка всех подзадач.
- `DELETE /subtask/{id}` — Удаление подзадачи по ID.
- `GET /subtask/prioritized` — Получение подзадач, отсортированных по приоритету (`IN_PROGRESS`, `NEW`, `DONE`) и времени завершения.

### 4. `TaskController.java`
**Описание**: Управляет задачами — основными единицами работы в системе.  
**Эндпоинты**:
- `POST /task` — Создание новой задачи.
- `PUT /task` — Обновление существующей задачи.
- `GET /task/{id}` — Получение задачи по ID.
- `GET /task` — Получение списка всех задач.
- `DELETE /task/{id}` — Удаление задачи по ID.
- `GET /task/prioritized` — Получение задач, отсортированных по приоритету (`IN_PROGRESS`, `NEW`, `DONE`) и времени завершения.

## Основные особенности

- **Документация API**: Эндпоинты аннотированы с помощью `@Operation`, `@ApiResponses`, `@Tag` для генерации спецификации OpenAPI. Документация доступна через Swagger UI по пути `/swagger-ui.html`.
- **Логирование**: Используется SLF4J (`@Slf4j`) для записи операций (создание, обновление, удаление, получение) в логи.
- **Валидация данных**: Входящие запросы проверяются с помощью аннотаций `@Valid`, `@NotNull`, `@Positive`.
- **CORS**: Поддержка кросс-доменных запросов через `@CrossOrigin`.
- **Коды HTTP-ответов**:
    - `201 Created` — Успешное создание ресурса.
    - `200 OK` — Успешное получение или обновление ресурса.
    - `204 No Content` — Успешное удаление ресурса.
    - `404 Not Found` — Ресурс не найден.
    - `409 Conflict` — Конфликт (например, дублирование имени).
    - `500 Internal Server Error` — Внутренняя ошибка (например, проблемы с Redis в `HistoryController`).
- **Сортировка по приоритету**: Эндпоинты `/prioritized` возвращают списки, отсортированные по статусу (`IN_PROGRESS` → `NEW` → `DONE`) и времени завершения (от раннего к позднему).

## Зависимости

Контроллеры используют сервисы, инжектируемые через конструктор (`@RequiredArgsConstructor`):
- `EpicService` — для работы с эпиками.
- `HistoryService` — для работы с историей доступа (зависит от Redis).
- `SubtaskService` — для работы с подзадачами.
- `TaskService` — для работы с задачами.

## Документация API

API документируется с использованием Springdoc OpenAPI. Доступ к документации:
- **Swagger UI**: `http://localhost:8080/swagger-ui.html`
- **OpenAPI JSON**: `http://localhost:8080/v3/api-docs`

Конфигурация Springdoc:
- Название API: **Task Manager API**
- Версия: **1.0.0**
- Сортировка: Теги и операции сортируются по алфавиту (`tags-sorter: alpha`, `operations-sorter: alpha`).

## Пример использования

Контроллеры предназначены для взаимодействия с клиентскими приложениями через REST API. Для тестирования используйте Swagger UI или инструменты вроде `curl`.

**Пример создания эпика**:
```bash
curl -X POST http://localhost:8080/epic \
-H "Content-Type: application/json" \
-d '{"name": "Новый эпик", "description": "Описание эпика"}'
```

**Пример получения истории**:
```bash
curl -X GET http://localhost:8080/history
```

## Примечания

- **Redis**: Для работы `HistoryController` требуется подключение к Redis, так как история хранится в кэше.
- **DTO**: Контроллеры используют объекты передачи данных (DTO) для строгой типизации и валидации.
- **RESTful-дизайн**: Эндпоинты следуют принципам REST, обеспечивая удобное взаимодействие.
- **Swagger UI**: Документация API доступна по пути `/swagger-ui.html` после запуска приложения.

## Дополнительно

Для подробной информации о структуре DTO или сервисах см. папки `dto` и `service`. По вопросам настройки или расширения API обращайтесь к документации проекта или разработчикам.